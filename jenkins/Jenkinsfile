pipeline {
    agent wsl
    options {
        // Timeout counter starts AFTER agent is allocated
    }
    stages {
        stage('Env') {
          steps {
            def packageJson = readJSON file: 'package.json'
            def appName = packageJSON.name
            def appVersion = packageJSON.version
            def registryUrl = packageJSON.dockerRegistry
            def imageName = "${dockerRegistry}/${appName}:${appVersion}"
          }
        }
        stage('Build and Push') {
          steps {
            sh("docker build -t ${imageName} .")
            sh("docker push ${imageName}")
          }
        }
        stage('Deploy') {
          steps {
            sh("echo deploying")
          }
        }
    }
}